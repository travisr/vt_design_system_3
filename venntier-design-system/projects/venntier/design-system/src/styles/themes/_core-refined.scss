@use '@angular/material' as mat;
@use '../tokens' as tokens;

// Refined OpenAI-style Material overrides
@mixin vt-material-theme($theme-type: 'light') {
  $theme: mat.define-theme((
    color: (
      theme-type: $theme-type,
      use-system-variables: true,
      system-variables-prefix: md-sys-color,
    ),
    typography: (
      use-system-variables: true,
      system-variables-prefix: md-sys-typescale,
    ),
  ));
  
  body {
    @include mat.all-component-themes($theme);
  }
  
  @include vt-component-overrides-refined();
}

@mixin vt-component-overrides-refined() {
  // Global refinements
  * {
    --mdc-elevation-box-shadow-for-gss: none !important;
  }
  
  body {
    background: #ffffff !important;  // Clean white background
    color: #000000 !important;       // Pure black for main text
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  
  // Remove ALL shadows
  [class*='mat-elevation-z'],
  [class*='mat-mdc-elevation'],
  .mat-mdc-card,
  .mat-mdc-menu-panel,
  .mat-mdc-dialog-container {
    box-shadow: none !important;
  }
  
  // BUTTONS - Refined with proper heights and padding
  .mat-mdc-button,
  .mat-mdc-raised-button,
  .mat-mdc-flat-button,
  .mat-mdc-stroked-button,
  .mat-mdc-icon-button {
    --mdc-text-button-container-height: 40px;
    --mdc-filled-button-container-height: 40px;
    --mdc-outlined-button-container-height: 40px;
    
    height: 40px !important;
    min-height: 40px !important;
    border-radius: 6px !important;
    font-weight: 400 !important;  // Lighter weight
    font-size: 14px !important;
    letter-spacing: 0.01em !important;
    padding: 0 20px !important;
    transition: all 0.15s ease !important;
    box-shadow: none !important;
    
    // Remove all ripples
    .mat-mdc-button-ripple,
    .mat-mdc-button-persistent-ripple,
    .mat-ripple {
      display: none !important;
    }
  }
  
  // Primary button (green CTA)
  .mat-mdc-raised-button.mat-primary,
  .mat-mdc-flat-button.mat-primary {
    background-color: #10a37f !important;
    color: white !important;
    font-weight: 500 !important;
    
    &:not(:disabled):hover {
      background-color: #0d9d6e !important;
      transform: translateY(-1px);
    }
    
    &:not(:disabled):active {
      transform: translateY(0);
    }
  }
  
  // Secondary (outlined)
  .mat-mdc-stroked-button,
  .mat-mdc-outlined-button {
    background-color: transparent !important;
    color: #202123 !important;
    border: 1px solid #d9d9e3 !important;
    
    &:not(:disabled):hover {
      background-color: #f7f7f8 !important;
      border-color: #c5c5d2 !important;
    }
  }
  
  // Tertiary (flat) - lighter background
  .mat-mdc-flat-button:not(.mat-primary) {
    background-color: #ececf1 !important;  // Lighter gray
    color: #202123 !important;
    border: none !important;
    
    &:not(:disabled):hover {
      background-color: #e5e5ea !important;
    }
  }
  
  // Text button
  .mat-mdc-button {
    background-color: transparent !important;
    color: #565869 !important;
    padding: 0 12px !important;
    
    &:not(:disabled):hover {
      background-color: #f7f7f8 !important;
      color: #202123 !important;
    }
  }
  
  // Disabled state - better visibility
  button:disabled {
    opacity: 0.4 !important;
    background-color: #f4f4f4 !important;
    color: #8e8ea0 !important;
  }
  
  // CARDS - Refined with proper layering
  .mat-mdc-card {
    border: 1px solid #e5e5ea !important;
    border-radius: 8px !important;
    padding: 24px !important;
    background-color: white !important;
    margin-bottom: 24px !important;
    
    .mat-mdc-card-header {
      padding: 0 0 20px 0 !important;
      
      .mat-mdc-card-title {
        font-size: 16px !important;
        font-weight: 600 !important;
        color: #000000 !important;
        margin: 0 !important;
      }
    }
    
    .mat-mdc-card-content {
      padding: 0 !important;
      
      > *:not(:last-child) {
        margin-bottom: 16px !important;
      }
    }
  }
  
  // FORM FIELDS - Clean OpenAI style
  .mat-mdc-form-field {
    width: 100% !important;
    margin-bottom: 20px !important;
    
    // Remove all Material Design artifacts
    .mat-mdc-text-field-wrapper {
      padding: 0 !important;
    }
    
    .mat-mdc-form-field-flex {
      align-items: stretch !important;
    }
    
    // Outline appearance
    &.mat-form-field-appearance-outline {
      .mdc-text-field {
        height: 44px !important;
        background-color: white !important;
        border-radius: 6px !important;
        padding: 0 !important;
        
        &.mdc-text-field--outlined {
          .mdc-notched-outline {
            top: 0 !important;
            
            // Clean border without notch
            .mdc-notched-outline__leading {
              border: 1px solid #d9d9e3 !important;
              border-right: none !important;
              border-radius: 6px 0 0 6px !important;
              width: 12px !important;
            }
            
            .mdc-notched-outline__trailing {
              border: 1px solid #d9d9e3 !important;
              border-left: none !important;
              border-radius: 0 6px 6px 0 !important;
            }
            
            .mdc-notched-outline__notch {
              border-top: 1px solid #d9d9e3 !important;
              border-bottom: 1px solid #d9d9e3 !important;
              border-left: none !important;
              border-right: none !important;
              max-width: 100% !important;
            }
          }
          
          &:hover .mdc-notched-outline {
            .mdc-notched-outline__leading,
            .mdc-notched-outline__trailing {
              border-color: #c5c5d2 !important;
            }
            .mdc-notched-outline__notch {
              border-top-color: #c5c5d2 !important;
              border-bottom-color: #c5c5d2 !important;
            }
          }
          
          &.mdc-text-field--focused .mdc-notched-outline {
            .mdc-notched-outline__leading,
            .mdc-notched-outline__trailing {
              border-color: #10a37f !important;
              border-width: 2px !important;
            }
            .mdc-notched-outline__notch {
              border-top: 2px solid #10a37f !important;
              border-bottom: 2px solid #10a37f !important;
            }
          }
        }
        
        // Input alignment
        .mat-mdc-form-field-infix {
          padding: 0 16px !important;
          border: none !important;
          min-height: 44px !important;
          display: flex !important;
          align-items: center !important;
        }
        
        input,
        textarea {
          padding: 0 !important;
          height: 100% !important;
          font-size: 14px !important;
          font-weight: 400 !important;
          color: #202123 !important;
          border: none !important;
          background: transparent !important;
          outline: none !important;
          
          &::placeholder {
            color: #8e8ea0 !important;
          }
        }
        
        textarea {
          padding: 12px 0 !important;
          min-height: 60px !important;
          resize: vertical;
        }
      }
      
      // Clean label
      .mat-mdc-floating-label {
        font-size: 14px !important;
        color: #565869 !important;
        background-color: white !important;
        padding: 0 4px !important;
        top: 50% !important;
        transform: translateY(-50%) !important;
        transition: all 0.2s ease !important;
        pointer-events: none !important;
        
        &.mdc-floating-label--float-above {
          font-size: 12px !important;
          top: 0 !important;
          transform: translateY(-50%) scale(0.85) !important;
          background-color: white !important;
        }
      }
      
      // Hide ripple and subscript
      .mdc-line-ripple,
      .mat-mdc-form-field-subscript-wrapper {
        display: none !important;
      }
    }
    
    // Icons - properly aligned
    .mat-mdc-form-field-icon-suffix,
    .mat-mdc-form-field-icon-prefix {
      padding: 0 12px !important;
      display: flex !important;
      align-items: center !important;
      height: 44px !important;
      
      mat-icon {
        font-size: 20px !important;
        width: 20px !important;
        height: 20px !important;
        color: var(--md-sys-color-on-surface-variant) !important;
      }
    }
  }
  
  // SELECT - Fixed alignment to match input fields
  .mat-mdc-select {
    &.mat-mdc-select-outlined {
      .mat-mdc-select-trigger {
        height: 44px !important;
        padding: 0 !important;
      }
      
      .mat-mdc-select-value {
        padding: 0 16px !important;
        font-size: 14px !important;
        color: #202123 !important;
        display: flex !important;
        align-items: center !important;
        height: 44px !important;
      }
      
      .mat-mdc-select-arrow-wrapper {
        padding-right: 16px !important;
        
        .mat-mdc-select-arrow {
          color: #8e8ea0 !important;
        }
      }
    }
  }
  
  // Select panel dropdown
  .mat-mdc-select-panel {
    border: 1px solid #e5e5ea !important;
    border-radius: 6px !important;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
    margin-top: 4px !important;
    
    .mat-mdc-option {
      height: 40px !important;
      padding: 0 16px !important;
      font-size: 14px !important;
      
      &:hover {
        background-color: #f7f7f8 !important;
      }
      
      &.mat-mdc-option-active,
      &.mdc-list-item--selected {
        background-color: #ececf1 !important;
        color: #202123 !important;
      }
    }
  }
  
  // TOOLBAR - Minimal style
  .mat-toolbar {
    background-color: white !important;
    color: #202123 !important;
    border-bottom: 1px solid #e5e5ea !important;
    height: 56px !important;
    padding: 0 32px !important;
    font-weight: 400 !important;
    
    &.mat-primary {
      background-color: white !important;
    }
  }
  
  // TYPOGRAPHY - Global refinements
  h1, h2, h3, h4, h5, h6 {
    color: #000000 !important;
    margin-top: 0 !important;
  }
  
  h1 {
    font-weight: 600 !important;
    font-size: 32px !important;
    line-height: 1.4 !important;
    margin-bottom: 12px !important;
  }
  
  h2 {
    font-weight: 600 !important;
    font-size: 24px !important;
    line-height: 1.5 !important;
    margin-bottom: 16px !important;
  }
  
  h3 {
    font-weight: 600 !important;
    font-size: 18px !important;
    line-height: 1.5 !important;
    margin-bottom: 12px !important;
  }
  
  p {
    color: #666666 !important;
    line-height: 1.6 !important;
    margin-bottom: 12px !important;
  }
  
  // CHECKBOXES & RADIOS - Subtle green accent
  .mat-mdc-checkbox {
    --mdc-checkbox-selected-icon-color: #10a37f;
    --mdc-checkbox-selected-checkmark-color: white;
    --mdc-checkbox-unselected-icon-color: #d9d9e3;
    
    .mdc-checkbox__background {
      border-radius: 4px !important;
    }
  }
  
  .mat-mdc-radio-button {
    --mdc-radio-selected-icon-color: #10a37f;
    --mdc-radio-unselected-icon-color: #d9d9e3;
  }
  
  // CHIPS - Lighter style
  .mat-mdc-chip {
    --mdc-chip-container-height: 32px;
    
    border: 1px solid #e5e5ea !important;
    background-color: #fafafa !important;
    font-size: 13px !important;
    font-weight: 400 !important;
    
    &.mat-mdc-chip-selected {
      background-color: #ececf1 !important;
      border-color: #c5c5d2 !important;
      color: #202123 !important;
    }
  }
  
  // MENU
  .mat-mdc-menu-panel {
    border: 1px solid #e5e5ea !important;
    border-radius: 8px !important;
    background-color: white !important;
    padding: 4px 0 !important;
    
    .mat-mdc-menu-item {
      font-size: 14px !important;
      height: 40px !important;
      padding: 0 16px !important;
      color: #202123 !important;
      
      &:hover {
        background-color: #f7f7f8 !important;
      }
      
      &.mat-mdc-menu-item-highlighted {
        background-color: #f7f7f8 !important;
      }
    }
  }
  
  // PROGRESS
  .mat-mdc-progress-bar {
    --mdc-linear-progress-active-indicator-color: #10a37f !important;
    --mdc-linear-progress-track-color: #e5e5ea !important;
    height: 4px !important;
    border-radius: 2px !important;
  }
  
  .mat-mdc-progress-spinner {
    --mdc-circular-progress-active-indicator-color: #10a37f !important;
  }
  
  // SNACKBAR
  .mat-mdc-snack-bar-container {
    --mdc-snackbar-container-color: #202123;
    --mdc-snackbar-supporting-text-color: white;
    
    border-radius: 8px !important;
    
    .mat-mdc-snack-bar-action {
      color: #7dd3c0 !important;
    }
  }
  
  // DIALOG
  .mat-mdc-dialog-container {
    border: 1px solid #e5e5ea !important;
    border-radius: 12px !important;
    padding: 32px !important;
    background-color: white !important;
  }
  
  // TABLE
  table.mat-mdc-table {
    border: 1px solid #e5e5ea !important;
    border-radius: 8px !important;
    overflow: hidden;
    background-color: white !important;
    
    .mat-mdc-header-row {
      background-color: #fafafa !important;
      height: 48px !important;
      border-bottom: 1px solid #e5e5ea !important;
    }
    
    .mat-mdc-row {
      height: 52px !important;
      border-bottom: 1px solid #f4f4f4 !important;
      
      &:hover {
        background-color: #fafafa !important;
      }
      
      &:last-child {
        border-bottom: none !important;
      }
    }
    
    .mat-mdc-cell,
    .mat-mdc-header-cell {
      font-size: 14px !important;
      padding: 0 16px !important;
    }
    
    .mat-mdc-header-cell {
      font-weight: 500 !important;
      color: #565869 !important;
    }
    
    .mat-mdc-cell {
      color: #202123 !important;
    }
  }
  
  // SLIDE TOGGLE
  .mat-mdc-slide-toggle {
    --mdc-switch-selected-track-color: #10a37f;
    --mdc-switch-selected-handle-color: white;
    --mdc-switch-selected-hover-track-color: #0d9d6e;
    --mdc-switch-unselected-track-color: #d9d9e3;
    --mdc-switch-unselected-handle-color: white;
  }
  
  // TOOLTIP
  .mat-mdc-tooltip {
    background-color: #202123 !important;
    color: white !important;
    font-size: 12px !important;
    padding: 6px 10px !important;
    border-radius: 6px !important;
  }
  
  // ICON refinements
  .mat-icon,
  mat-icon {
    font-size: 20px !important;
    width: 20px !important;
    height: 20px !important;
    color: #565869 !important;
    
    &.mat-icon-button mat-icon {
      font-size: 20px !important;
    }
  }
  
  // Focus states - subtle
  *:focus-visible {
    outline: 2px solid rgba(142, 142, 160, 0.3) !important;
    outline-offset: 2px !important;
  }
  
  // Selection
  ::selection {
    background-color: #d3f4eb !important;
    color: #202123 !important;
  }
}