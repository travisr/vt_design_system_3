// ============================================================================
// VENNTIER DESIGN SYSTEM - CORE REFINED THEME V2
// ============================================================================
// Modular, maintainable theme architecture following SCSS best practices
// Based on the 7-1 pattern with clear separation of concerns

@use '@angular/material' as mat;
@use '../tokens' as tokens;

// Import all theme modules
@use 'base' as base;
@use 'components' as components;
@use 'overrides' as overrides;

// ============================================================================
// MAIN THEME MIXIN
// ============================================================================

@mixin vt-theme-refined() {
  // 1. Base theme setup (Material Design 3 configuration)
  @include base.vt-material-base-theme;

  // 2. Component overrides (buttons, forms, navigation, etc.)
  @include components.vt-navigation-overrides;
  @include components.vt-button-overrides;
  @include components.vt-form-overrides;
  @include components.vt-layout-overrides;
  @include components.vt-feedback-overrides;

  // 3. Global overrides and utilities
  @include overrides.vt-density-overrides;
  @include overrides.vt-global-overrides;

  // 4. Core sidenav and navigation styles (OpenAI-style)
  @include vt-sidenav-core-styles;
}

// ============================================================================
// THEME VARIANTS
// ============================================================================

@mixin vt-theme-colors($theme-type: 'light') {
  @include base.vt-material-colors($theme-type);
}

// ============================================================================
// UTILITY MIXINS
// ============================================================================

// Apply only navigation styles (for testing/debugging)
@mixin vt-navigation-only() {
  @include base.vt-custom-color-tokens;
  @include components.vt-navigation-overrides;
}

// Apply only button styles (for testing/debugging)
@mixin vt-buttons-only() {
  @include base.vt-custom-color-tokens;
  @include components.vt-button-overrides;
}

// Apply only form styles (for testing/debugging)
@mixin vt-forms-only() {
  @include base.vt-custom-color-tokens;
  @include components.vt-form-overrides;
}

// ============================================================================
// CORE SIDENAV STYLES - OpenAI Style Navigation
// ============================================================================

@mixin vt-sidenav-core-styles() {
  // FIRST: Override Angular Material list component defaults for compact spacing
  @include mat.list-overrides(
    (
      // Override the default list item heights for compact sizing (OpenAI style)
      list-item-one-line-container-height: var(--mat-sys-spacing-36, 36px),
      // Token-based height for better OpenAI-style readability
      list-item-two-line-container-height: var(--mat-sys-spacing-44, 44px),
      // Token-based height for better readability
      list-item-three-line-container-height: var(--mat-sys-spacing-52, 52px),
      // Token-based height for better readability
      // Typography overrides for tighter text using tokens
      list-item-label-text-size: var(--mat-sys-body-medium-size, 14px),
      list-item-label-text-line-height: var(--mat-sys-body-medium-line-height, 18px)
    )
  );

  // Sidenav overrides - MD3 token-based styling using correct Angular Material token format
  @include mat.sidenav-overrides(
    (
      // Container styling - this is the sidenav drawer (navigation area)
      // Use nav-specific surface token for OpenAI-style navigation background
      container-background-color: var(--mat-sys-surface-container-nav),
      container-text-color: var(--mat-sys-on-surface),
      container-shape: 0,
      // Remove border-radius from sidenav container
      // Content styling - this is the main content area (should be white)
      content-background-color: var(--mat-sys-surface),
      content-text-color: var(--mat-sys-on-surface)
    )
  );

  // Sidenav width - OpenAI style using proper tokens
  .vt-sidenav-standard {
    width: var(--mat-sys-sidenav-width);
    min-width: var(--mat-sys-sidenav-width);
    max-width: var(--mat-sys-sidenav-width);

    // Background handled by Angular Material overrides above - don't override here

    // CRITICAL: Remove border-radius from sidenav container
    border-radius: 0;

    // Remove scrollbars completely - OpenAI style has no visible scrollbars
    overflow: hidden;
  }

  // Ensure sidenav styling is applied with higher specificity
  mat-sidenav.vt-sidenav-standard {
    // Background handled by Angular Material overrides - don't override here

    // CRITICAL: Remove border-radius with high specificity
    border-radius: 0;

    // Ensure no scrollbars on the Material Design sidenav element itself
    overflow: hidden;

    // CRITICAL: Hide scrollbar on the inner container that's causing the issue
    .mat-drawer-inner-container {
      overflow-y: auto; // Allow vertical scrolling
      scrollbar-width: none; // Firefox
      -ms-overflow-style: none; // IE/Edge

      &::-webkit-scrollbar {
        display: none; // Chrome/Safari/Opera
      }
    }
  }

  // Also target the mat-sidenav element directly in case class isn't applied
  mat-sidenav {
    // Background handled by Angular Material overrides - don't override here

    // Also hide scrollbars on any mat-sidenav
    .mat-drawer-inner-container {
      overflow-y: auto; // Allow vertical scrolling
      scrollbar-width: none;
      -ms-overflow-style: none;

      &::-webkit-scrollbar {
        display: none;
      }
    }
  }

  // Clean navigation item styling - OpenAI inspired with tighter spacing
  .vt-sidenav-standard mat-nav-list a[mat-list-item] {
    // Reset Material Design defaults and set base layout
    display: flex;
    align-items: center;
    text-decoration: none;
    position: relative;

    // Layout - balanced OpenAI-style spacing using tokens
    padding: var(--mat-sys-spacing-6, 6px) var(--mat-sys-spacing-8, 8px); // Token-based padding
    margin: 0; // No horizontal margin - container has padding for shading space
    margin-bottom: var(--mat-sys-spacing-3, 3px); // Token-based spacing between items
    border-radius: var(--mat-sys-spacing-6, 6px); // Token-based OpenAI style rounded corners

    // CRITICAL: Override Angular Material's fixed height to allow compact sizing
    height: auto; // Override Material's 56px height
    min-height: auto; // Remove min-height constraints

    // Default state - no background, gray text using tokens (OpenAI style)
    background-color: transparent;
    color: var(--mat-sys-on-surface-variant); // Token-based color for default text
    font-size: var(--mat-sys-body-medium-size, 14px);
    line-height: var(--mat-sys-body-medium-line-height, 18px); // Token-based line height
    transition: all var(--mat-sys-motion-duration-short2, 0.15s)
      var(--mat-sys-motion-easing-standard, ease);

    // Icon styling - tighter spacing
    mat-icon {
      font-size: var(--mat-sys-spacing-16, 16px);
      width: var(--mat-sys-spacing-16, 16px);
      height: var(--mat-sys-spacing-16, 16px);
      line-height: var(--mat-sys-spacing-16, 16px);
      margin-right: var(
        --mat-sys-spacing-10,
        10px
      ); // Reduced from 12px to 10px for tighter spacing

      color: inherit;
      flex-shrink: 0;
    }

    // Text styling - tighter line height
    span {
      font-size: var(--mat-sys-body-medium-size, 14px);
      line-height: var(--mat-sys-body-medium-line-height, 18px); // Reduced from 20px to 18px
      color: inherit;
      font-weight: 400; // Normal weight by default
    }

    // Hover state - use dedicated hover token for better contrast
    // Use higher specificity to override Angular Material
    &:hover:not(.active) {
      background-color: var(--mat-sys-hover);
      color: var(--mat-sys-on-surface);
    }
  }

  // Selected/active state - ONLY for items with .active class
  .vt-sidenav-standard mat-nav-list a[mat-list-item].active {
    background-color: var(--mat-sys-selected);
    color: var(--mat-sys-on-surface);
    font-weight: 500;

    span {
      font-weight: 500;
      color: inherit;
    }

    mat-icon {
      color: inherit;
    }

    // Keep selected styling on hover
    &:hover {
      background-color: var(--mat-sys-selected);
      color: var(--mat-sys-on-surface);
    }
  }

  // Higher specificity hover rule to override Angular Material
  .vt-sidenav-standard mat-nav-list a[mat-list-item].mat-mdc-list-item:hover:not(.active) {
    background-color: var(--mat-sys-hover);
    color: var(--mat-sys-on-surface);

    span {
      color: var(--mat-sys-on-surface);
    }

    mat-icon {
      color: var(--mat-sys-on-surface);
    }
  }

  // Sidenav header styling
  .vt-sidenav-header {
    // Match toolbar height exactly: 64px = 8 Ã— 8px foundation
    height: var(--mat-sys-spacing-64, 64px);
    padding: 0 var(--mat-sys-spacing-16, 16px);
    border-bottom: 1px solid var(--mat-sys-outline-variant);
    margin-bottom: var(--mat-sys-spacing-16, 16px);

    // Center content vertically within the 64px height
    display: flex;
    align-items: center;
  }

  .vt-sidenav-logo {
    display: flex;
    align-items: center;
    gap: var(--mat-sys-spacing-8, 8px); // Token-based spacing between logo and text

    span {
      font-size: var(--mat-sys-title-medium-size, 16px); // Proper branding size
      font-weight: var(--mat-sys-title-medium-weight, 600); // Semi-bold for branding
      color: var(--mat-sys-on-surface);
      line-height: 1.2; // Tight line height for branding
    }
  }

  // Target the navigation content container with higher specificity
  mat-sidenav.vt-sidenav-standard .vt-sidenav-content,
  .vt-sidenav-standard .vt-sidenav-content {
    // Add horizontal padding to create space around the shading - tighter spacing
    padding: 0 var(--mat-sys-spacing-6, 6px); // Reduced from 8px to 6px for tighter layout

    // Ensure content scrolls properly - OpenAI style
    overflow-y: auto;
    height: calc(100vh - 80px); // Account for header height

    // Custom scrollbar styling using tokens
    &::-webkit-scrollbar {
      width: var(--mat-sys-spacing-6, 6px); // Token-based scrollbar width
    }

    &::-webkit-scrollbar-track {
      background: transparent;
    }

    &::-webkit-scrollbar-thumb {
      background-color: var(--mat-sys-outline-variant);
      border-radius: var(--mat-sys-spacing-3, 3px); // Token-based border radius

      &:hover {
        background-color: var(--mat-sys-outline);
      }
    }
  }

  .vt-nav-section {
    margin-bottom: var(--mat-sys-spacing-4, 4px); // Token-based section spacing for OpenAI look
  }

  .vt-nav-section-title {
    // Token-based typography specifications
    font-size: var(--mat-sys-label-small-size, 11px);
    font-weight: var(--mat-sys-label-small-weight, 600);
    text-transform: uppercase;
    letter-spacing: var(--mat-sys-label-small-tracking, 0.5px);
    color: var(--mat-sys-on-surface-variant); // Token-based color
    padding: var(--mat-sys-spacing-6, 6px) var(--mat-sys-spacing-12, 12px); // Token-based padding
    margin-bottom: var(--mat-sys-spacing-4, 4px); // Token-based margin
  }
}
