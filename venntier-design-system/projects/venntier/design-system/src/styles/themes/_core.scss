@use '@angular/material' as mat;
@use '../tokens' as tokens;

// Configure Angular Material to use our M3 tokens
@mixin vt-material-theme($theme-type: 'light') {
  // Define the M3 theme using system variables
  $theme: mat.define-theme((
    color: (
      theme-type: $theme-type,
      use-system-variables: true,
      system-variables-prefix: md-sys-color,
    ),
    typography: (
      use-system-variables: true,
      system-variables-prefix: md-sys-typescale,
    ),
  ));
  
  // Apply base Material theme with proper selector
  body {
    @include mat.all-component-themes($theme);
  }
  
  // Apply our custom component overrides
  @include vt-component-overrides();
}

// Component-specific overrides for OpenAI-style design
@mixin vt-component-overrides() {
  // Remove ALL Material elevation/shadows globally
  * {
    --mdc-elevation-box-shadow-for-gss: none !important;
  }
  
  [class*='mat-elevation-z'],
  [class*='mat-mdc-elevation'] {
    box-shadow: none !important;
  }
  
  // Button overrides
  .mat-mdc-button,
  .mat-mdc-raised-button,
  .mat-mdc-flat-button,
  .mat-mdc-stroked-button,
  .mat-mdc-icon-button,
  .mat-mdc-fab,
  .mat-mdc-mini-fab {
    --mdc-text-button-container-height: 36px;
    --mdc-filled-button-container-height: 36px;
    --mdc-outlined-button-container-height: 36px;
    --mdc-protected-button-container-height: 36px;
    
    height: 36px !important;
    min-height: 36px !important;
    border-radius: 6px !important;
    font-weight: 500 !important;
    font-size: 14px !important;
    letter-spacing: 0 !important;
    padding: 0 16px !important;
    transition: all 0.15s ease !important;
    box-shadow: none !important;
    
    .mat-mdc-button-ripple,
    .mat-mdc-button-persistent-ripple,
    .mat-mdc-button-persistent-ripple::before {
      display: none !important;
    }
    
    &:not(:disabled) {
      cursor: pointer;
    }
    
    &:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  }
  
  // Primary button (green CTA) - ONLY green button
  .mat-mdc-raised-button.mat-primary,
  .mat-mdc-flat-button.mat-primary {
    background-color: #10a37f !important;
    color: white !important;
    border: none !important;
    
    &:not(:disabled):hover {
      background-color: #0e9168 !important;
    }
    
    &:not(:disabled):active {
      background-color: #0c7f5f !important;
    }
  }
  
  // Secondary button (outlined)
  .mat-mdc-stroked-button,
  .mat-mdc-outlined-button {
    background-color: transparent !important;
    color: var(--md-sys-color-on-surface) !important;
    border: 1px solid #e5e5e5 !important;
    
    &:not(:disabled):hover {
      background-color: #f7f7f8 !important;
      border-color: #d4d4d4 !important;
    }
  }
  
  // Tertiary/Flat button
  .mat-mdc-flat-button:not(.mat-primary) {
    background-color: #f7f7f8 !important;
    color: var(--md-sys-color-on-surface) !important;
    border: none !important;
    
    &:not(:disabled):hover {
      background-color: #ececf1 !important;
    }
  }
  
  // Text button
  .mat-mdc-button {
    background-color: transparent !important;
    color: var(--md-sys-color-on-surface) !important;
    
    &:not(:disabled):hover {
      background-color: #f7f7f8 !important;
    }
  }
  
  // Card overrides - flat with subtle border
  .mat-mdc-card {
    --mdc-elevated-card-container-elevation: 0;
    --mdc-outlined-card-container-elevation: 0;
    
    border: 1px solid #e5e5e5 !important;
    border-radius: 8px !important;
    padding: 24px !important;
    background-color: white !important;
    box-shadow: none !important;
    
    .mat-mdc-card-header {
      padding: 0 0 16px 0 !important;
    }
    
    .mat-mdc-card-title {
      font-size: 16px !important;
      font-weight: 600 !important;
      color: #1a1a1a !important;
    }
    
    .mat-mdc-card-content {
      padding: 0 !important;
    }
  }
  
  // Input/Form field overrides - OpenAI style
  .mat-mdc-form-field {
    --mdc-filled-text-field-container-color: transparent;
    --mdc-outlined-text-field-outline-color: #e5e5e5;
    --mdc-outlined-text-field-hover-outline-color: #d4d4d4;
    --mdc-outlined-text-field-focus-outline-color: #6e6e80;
    --mdc-outlined-text-field-focus-outline-width: 1px;
    --mdc-outlined-text-field-container-shape: 6px;
    --mat-form-field-container-height: 40px;
    
    .mdc-text-field {
      height: 40px !important;
      background-color: white !important;
      border-radius: 6px !important;
      padding: 0 !important;
      
      &.mdc-text-field--outlined {
        .mdc-notched-outline__leading,
        .mdc-notched-outline__notch,
        .mdc-notched-outline__trailing {
          border-color: #e5e5e5 !important;
          border-width: 1px !important;
        }
        
        &:hover .mdc-notched-outline__leading,
        &:hover .mdc-notched-outline__notch,
        &:hover .mdc-notched-outline__trailing {
          border-color: #d4d4d4 !important;
        }
        
        &.mdc-text-field--focused .mdc-notched-outline__leading,
        &.mdc-text-field--focused .mdc-notched-outline__notch,
        &.mdc-text-field--focused .mdc-notched-outline__trailing {
          border-color: #6e6e80 !important;
          border-width: 1px !important;
        }
      }
      
      input,
      textarea {
        padding: 8px 12px !important;
        font-size: 14px !important;
        font-weight: 400 !important;
      }
    }
    
    // Remove ripple effects
    .mat-mdc-form-field-ripple {
      display: none !important;
    }
    
    // Label styling
    .mat-mdc-form-field-label {
      color: #6e6e80 !important;
      font-size: 14px !important;
      font-weight: 400 !important;
    }
    
    // Remove all animations/transitions
    * {
      transition: none !important;
    }
  }
  
  // Select dropdown styling
  .mat-mdc-select {
    .mat-mdc-select-trigger {
      height: 40px !important;
      padding: 0 12px !important;
    }
    
    .mat-mdc-select-value {
      font-size: 14px !important;
    }
  }
  
  // Checkbox and Radio - minimal style
  .mat-mdc-checkbox,
  .mat-mdc-radio-button {
    .mdc-checkbox,
    .mdc-radio {
      --mdc-checkbox-selected-icon-color: #10a37f;
      --mdc-checkbox-selected-hover-icon-color: #0e9168;
      --mdc-radio-selected-icon-color: #10a37f;
      --mdc-radio-selected-hover-icon-color: #0e9168;
    }
  }
  
  // Toolbar
  .mat-toolbar {
    background-color: white !important;
    color: #1a1a1a !important;
    border-bottom: 1px solid #e5e5e5 !important;
    box-shadow: none !important;
    height: 56px !important;
    padding: 0 24px !important;
    
    &.mat-primary {
      background-color: white !important;
    }
  }
  
  // Menu
  .mat-mdc-menu-panel {
    border: 1px solid #e5e5e5 !important;
    border-radius: 6px !important;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08) !important;
    
    .mat-mdc-menu-item {
      font-size: 14px !important;
      height: 36px !important;
      
      &:hover {
        background-color: #f7f7f8 !important;
      }
    }
  }
  
  // Chips
  .mat-mdc-chip {
    --mdc-chip-container-shape-radius: 16px;
    --mdc-chip-container-height: 28px;
    
    border: 1px solid #e5e5e5 !important;
    background-color: white !important;
    font-size: 13px !important;
    
    &.mat-mdc-chip-selected {
      background-color: #ececf1 !important;
      border-color: transparent !important;
    }
  }
  
  // Tables
  .mat-mdc-table {
    border: 1px solid #e5e5e5 !important;
    border-radius: 8px !important;
    overflow: hidden;
    
    .mat-mdc-header-row {
      background-color: #fafafa !important;
      height: 40px !important;
    }
    
    .mat-mdc-row {
      height: 48px !important;
      border-bottom: 1px solid #e5e5e5 !important;
      
      &:hover {
        background-color: #f7f7f8 !important;
      }
      
      &:last-child {
        border-bottom: none !important;
      }
    }
    
    .mat-mdc-cell,
    .mat-mdc-header-cell {
      font-size: 14px !important;
      color: #1a1a1a !important;
    }
  }
  
  // Progress indicators
  .mat-mdc-progress-bar {
    --mdc-linear-progress-active-indicator-color: #10a37f !important;
    --mdc-linear-progress-track-color: #e5e5e5 !important;
    height: 4px !important;
  }
  
  .mat-mdc-progress-spinner {
    --mdc-circular-progress-active-indicator-color: #10a37f !important;
  }
  
  // Snackbar
  .mat-mdc-snack-bar-container {
    --mdc-snackbar-container-color: #1a1a1a;
    --mdc-snackbar-supporting-text-color: white;
    
    border-radius: 6px !important;
    
    .mat-mdc-snack-bar-action {
      color: #10a37f !important;
    }
  }
  
  // Dialog
  .mat-mdc-dialog-container {
    --mdc-dialog-container-shape: 8px;
    --mdc-dialog-container-elevation-shadow: none;
    
    border: 1px solid #e5e5e5 !important;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08) !important;
  }
  
  // Global text color fix
  body {
    color: #1a1a1a !important;
  }
  
  // Typography overrides
  h1, h2, h3, h4, h5, h6 {
    color: #1a1a1a !important;
    font-weight: 600 !important;
  }
  
  p, span, div {
    color: #1a1a1a !important;
  }
}